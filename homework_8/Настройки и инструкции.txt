1. Развернул на минималках в облаке Яндекса Виртуальную Машину с CentOS7.

2. С помощью PuttyGen сгенерировал 2 ключа. Публичный прописал в настройках ВМ, секретный сохранил на компе.

3. Запустил Putty.exe в пункте SSH->Auth указал путь к секретному ключу (в левом столбце пункты настроек), далее перешел в настройку Session - указал публичный IP ВМ, указаннай яндексом в настройках машины, после ее запуска.

4. Запустился SSH сеанс между мной и удаленной ВМ.

5. на удаленную ВМ устанавливаю OpenVPM server:

yum -y install https://as-repository.openvpn.net/as-repo-centos7.rpm

yum -y install openvpn-as

после установки получил данные для входа:

Access Server Web UIs are available here:
Admin  UI: https://10.129.0.29:943/admin
Client UI: https://10.129.0.29:943/

To login please use the "openvpn" account 

with "cTw9jhPjgoCs" password.

(password can be changed on Admin UI)
+++++++++++++++++++++++++++++++++++++++++++++++

6. Зашел на www.noip.com создал учетку и доменное имя lancourse.ddns.net, к которому приписал публичный IP виртуальной машины, на которой крутится OpenVPM, к которому мы будем по этому доменному имени обращаться.

7. Для того чтобы можно было заходить по HTTPS нужно получить сертификаты в удостоверяющем центре. Для этого установим на виртуальной машине еще сертбота:

установка certbot по инструкции:
https://certbot.eff.org/instructions?ws=other&os=centosrhel7

при установке сертбота возникла ошибка из-за корявого пакета snapd, пришлось удалить и поставить старую версию:
yum remove snapd
yum remove snap-confine.x86_64
yum remove snapd-selinux.noarch
yum install -y https://mirror.lt.ucsc.edu/epel/7/x86_64/Packages/s/snapd-2.55.3-1.el7.x86_64.rpm
yum install - y https://mirror.lt.ucsc.edu/epel/7/x86_64/Packages/s/snap-confine-2.55.3-1.el7.x86_64.rpm
yum install -y https://mirror.lt.ucsc.edu/epel/7/x86_64/Packages/s/snapd-selinux-2.55.3-1.el7.noarch.rpm

установка успешно, инструкцию взял отсюда:
from https://forum.snapcraft.io/t/snap-exec-segfaults-on-centos-7-2-57-6-1-el7/33030/5

устанавливаем сертбота по инструкции (команды в ней), на email из 10-минутной почты:
sertbot's email:  pha81029@nezid.com

сертификаты выданы на имя: lancourse.ddns.net
находятся в:
Successfully received certificate.
Certificate is saved at: /etc/letsencrypt/live/lancourse.ddns.net/fullchain.pem
Key is saved at:         /etc/letsencrypt/live/lancourse.ddns.net/privkey.pem

This certificate expires on 2023-03-13.
These files will be updated when the certificate renews.
Certbot has set up a scheduled task to automatically renew this certificate in the background.

установка сертификатов:
приватный ключ:
/usr/local/openvpn_as/scripts/sacli --key "cs.priv_key" --value_file "/etc/letsencrypt/live/lancourse.ddns.net/privkey.pem" ConfigPut

публичный ключ:
/usr/local/openvpn_as/scripts/sacli --key "cs.cert" --value_file "/etc/letsencrypt/live/lancourse.ddns.net/fullchain.pem" ConfigPut

создаем на openVPM пользователя:
login: testuser
password: testuser

заходим на него - https работает.
все ок!

Теперь устанавливаем VPN-клиента, для того, чтобы создавать туннель до нашего VPN и выхода через него в интернет.

Для этого заходим на страничку testuser и скачиваем VPN-клиента, устанавливаем.
После чего скачиваем файл с настройками клиента. 
Открываем его с помощью блокнота, и меням в нем указанный в нем IP
(на момент установки это был внутренний адрес виртуальной машины на яндекс-облаке 10.129.0.29) 
на то доменное имя, которое мы указали ранее: lancourse.ddns.net.

После установки клиента, нажимаем в свойствах клиента 
	+ --> file --> brouse 
и подставляем файл с настройками. 
Вуаля, запускаем, проверяем, у нас другой IP - IP нашего яндекс облака.
Все, сессию настройки удаленной ВМ через SSH сессию Putty можно завершать.

Если завершить сессию ВМ на яндекс клоуде туннель закроется, а серевер закроется.
Поэтому чтобы запустить по новой нужно , на яндекс-клоуде запустить виртуальную машину, записать новый публичный IP, прописать его в доменное имя на no-ip.com, опять через Putty создать соединение через SSH с этой виртуалкой, указать в ней секрктный ключ и публичный IP, войти в консоль, ввести стандартный длиный пароль, в режиме админа запустить сервер:
/usr/local/openvpn_as/scripts/sacli start

далее можно запускать клиента и работать.


админка: https://lancourse.ddns.net:943/admin/
пароль в LastPass

смысл для чего нужно все было устанавливать можно почитать тут: 
https://letsencrypt.org/ru/how-it-works/
и тут:
https://openvpn.net/vpn-server-resources/managing-settings-for-the-web-services-from-the-command-line/#Installing_a_signed_SSL_certificate

здесь пр no-ip:
https://www.noip.com/support/knowledgebase/getting-started-with-no-ip-com/
